<!--  problem 4  Venkateshwar Rao Vodapally   -->


<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hand Pose Detection App</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose"></script>
  </head> 
  <body>
    <h1>Hand Pose Detection App</h1>
    <video id="video" width="440" height="380" autoplay></video>
    <canvas id="canvas" width="440" height="380"></canvas>
    <div id="gestureOutput"></div>
    <script>
      const handpose = window.handpose;

      // Load the Hand Pose Detection model
      async function loadModel() {
        const model = await handpose.load();
        console.log('Model loaded');

        // Get references to the video and canvas elements
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Start the webcam stream
        navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
          video.srcObject = stream;
          video.play();
        });

        // Make a prediction on each video frame
        video.addEventListener('loadeddata', function() {
          setInterval(async function() {
            // Draw the video frame on the canvas
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Make a prediction on the canvas image
            const predictions = await model.estimateHands(canvas, { scoreThreshold: 0.5, maxHands: 1 });
            console.log("predictions " + predictions);

            // Draw keypoints on the canvas
            if (predictions.length > 0) {
              const keypoints = predictions[0].landmarks;
              drawKeypoints(keypoints, ctx);
              recognizeGesture(keypoints);
            }
          }, 1000 / 30);
        });
      }

      function drawKeypoints(keypoints, ctx) {
        for (let i = 0; i < keypoints.length; i++) {
          const x = keypoints[i][0];
          const y = keypoints[i][1];
          ctx.beginPath();
          ctx.arc(x, y, 5, 0, 2 * Math.PI);
          ctx.fillStyle = "green";
          ctx.fill();
        }
      }

      function recognizeGesture(keypoints) {
        const thumbTip = keypoints[4];
        const indexFingerTip = keypoints[8];
        const middleFingerTip = keypoints[12];
        const ringFingerTip = keypoints[16];
        const pinkyTip = keypoints[20];

        const towardsRight = areAllFingersExtendedForward(thumbTip, indexFingerTip, middleFingerTip, ringFingerTip, pinkyTip);
        const fistGesture = isFistGesture(thumbTip, indexFingerTip, middleFingerTip, ringFingerTip, pinkyTip);
        const pointingGesture = isPointingGesture(thumbTip, indexFingerTip, middleFingerTip, ringFingerTip, pinkyTip);
       

        const gestureOutput = document.getElementById('gestureOutput');

        if (towardsRight) {
          gestureOutput.innerText = "Towards Right gesture detected";
        } else if (fistGesture) {
          gestureOutput.innerText = "Fist gesture detected";
        } else if (pointingGesture) {
          gestureOutput.innerText = "Pointing gesture detected";
        } else {
          gestureOutput.innerText = "";
        }
      }

      function areAllFingersExtendedForward(thumbTip, indexFingerTip, middleFingerTip, ringFingerTip, pinkyTip) {
        // Check if all fingers are extended forward
        return (
          thumbTip[1] < indexFingerTip[1] &&
          thumbTip[1] < middleFingerTip[1] &&
          thumbTip[1] < ringFingerTip[1] &&
          thumbTip[1] < pinkyTip[1] &&
          indexFingerTip[1] < middleFingerTip[1] &&
          indexFingerTip[1] < ringFingerTip[1] &&
          indexFingerTip[1] < pinkyTip[1] &&
          middleFingerTip[1] < ringFingerTip[1] &&
          middleFingerTip[1] < pinkyTip[1] &&
          ringFingerTip[1] < pinkyTip[1]
        );
      }

      function isFistGesture(thumbTip, indexFingerTip, middleFingerTip, ringFingerTip, pinkyTip) {
        // Fist gesture: All fingers closed with thumb wrapped around
        return (
          thumbTip[1] > indexFingerTip[1] &&
          thumbTip[1] > middleFingerTip[1] &&
          thumbTip[1] > ringFingerTip[1] &&
          thumbTip[1] > pinkyTip[1]
        );
      }

      function isPointingGesture(thumbTip, indexFingerTip, middleFingerTip, ringFingerTip, pinkyTip) {
        // Pointing gesture: Index finger extended forward, other fingers closed
        return (
          indexFingerTip[1] < middleFingerTip[1] &&
          indexFingerTip[1] < ringFingerTip[1] &&
          indexFingerTip[1] < pinkyTip[1] &&
          thumbTip[1] > indexFingerTip[1]
        );
      }

      loadModel();
    </script>
  </body>
</html>
